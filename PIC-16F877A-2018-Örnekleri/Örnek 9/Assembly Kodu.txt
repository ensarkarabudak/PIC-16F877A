   LIST P=16F877A
   INCLUDE "P16F877A.INC"
   SAYAC1   EQU 0X21
   SAYAC2   EQU 0X22
   SAYI_1 EQU 0X23
   SAYI_2 EQU 0X24
   SAYI_3 EQU 0X25
   SAYI_4 EQU 0X26
   SAYI	  EQU 0X27
 
   ORG	0X00
   GOTO	BASLA
   
   BASLA    
  
   BANKSEL  TRISC
   MOVLW    B'11110000'
   MOVWF    TRISC
   
   CLRF	    TRISD
   BANKSEL  PORTC
   CLRF	    PORTC
   
   BANKSEL  SPBRG
   MOVLW    B'00011001'
   MOVWF    SPBRG
   
   BANKSEL  TXSTA
   MOVLW    B'00000100'
   MOVWF    TXSTA
   
   BANKSEL  RCSTA
   MOVLW    B'10010000'
   MOVWF    RCSTA
   
   
   ;pwm
   BANKSEL  CCP1CON
   MOVLW    0X0F
   MOVWF    CCP1CON 
   BANKSEL  T2CON
   MOVLW    0X04
   MOVWF    T2CON 
   BANKSEL  PR2
   MOVLW    D'99'
   MOVWF    PR2 
   BANKSEL  CCPR1L
   MOVLW    D'50'
   MOVWF    CCPR1L 
 
DONGU
   MOVLW    D'49'
   MOVWF    SAYI_1
   MOVLW    D'50'
   MOVWF    SAYI_2
   MOVLW    D'51'
   MOVWF    SAYI_3
   MOVLW    D'52'
   MOVWF    SAYI_4
   
   CALL	    GECIKME
   BANKSEL  RCREG
   MOVF	    RCREG,W

   
   SUBWF    SAYI_1
   BTFSC    STATUS,Z
   GOTO	    PWM_ARTIR
   
   
   SUBWF    SAYI_2
   BTFSC    STATUS,Z
   GOTO	    PWM_AZALT
   
   SUBWF    SAYI_3
   BTFSC    STATUS,Z
   GOTO	    SAG_DON
   
   SUBWF    SAYI_4
   BTFSC    STATUS,Z
   GOTO	    SOLA_DON
   
   GOTO	    DONGU

SAG_DON
   BSF	PORTD,2
   BCF	PORTD,3
   GOTO DONGU
   
SOLA_DON 
   BCF	PORTD,2
   BSF	PORTD,3
   GOTO	DONGU
PWM_ARTIR
   CLRF	    RCREG
   CALL	    GECIKME
   CALL	    GECIKME
   MOVLW    D'100'
   MOVWF    SAYI
   BANKSEL  CCPR1L
   MOVF	    CCPR1L,W
   SUBWF    SAYI,F
   BTFSS    STATUS,Z
   GOTO	    E2
   MOVLW    D'100'
   MOVWF    CCPR1L
   GOTO CIK
E2
   ;MOVLW    D'10'
   ;ADDWF    CCPR1L
   INCF	    CCPR1L
CIK
   GOTO	    DONGU 
   
   
PWM_AZALT
   CLRF	    RCREG
   CALL	    GECIKME
   CALL	    GECIKME
   MOVLW    D'0'
   MOVWF    SAYI
   BANKSEL  CCPR1L
   MOVF	    CCPR1L,W
   SUBWF    SAYI,F
   BTFSS    STATUS,Z
   GOTO	    E3
   MOVLW    D'0'
   MOVWF    CCPR1L
   GOTO	    CIK2
E3
   ;MOVLW    D'10'
   ;SUBWF    CCPR1L
   DECF	    CCPR1L
CIK2
   GOTO	    DONGU
   
GECIKME
   MOVLW    0X04
   MOVWF    SAYAC1
   G2
   DECFSZ   SAYAC1
   GOTO	    G2
   MOVLW    0XFF
   MOVWF    SAYAC2
   G3
   DECFSZ   SAYAC2
   GOTO	    G3
   RETURN
   END
